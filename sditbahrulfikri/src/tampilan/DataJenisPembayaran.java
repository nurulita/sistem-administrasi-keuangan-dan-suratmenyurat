/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package tampilan;


import database.connection;
import java.awt.HeadlessException;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.KeyEvent;
import java.sql.*;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author nurul
 */
public class DataJenisPembayaran extends javax.swing.JFrame {
    private final Connection conn = connection.getConn();
    private final DefaultTableModel model;

    /**
     * Creates new form DataMataAnggaran
     */
    public DataJenisPembayaran() {
        initComponents();        
        model = new DefaultTableModel();

        tabelpendapatan.setModel(model);
        model.addColumn("Kode Pembayaran");
        model.addColumn("Nama Pembayaran");
        model.addColumn("Jumlah Bayar");
        model.addColumn("Nilai Perbulan");
        loadData();
    }
    
    public void FilterAngka(KeyEvent a){
       if(Character.isAlphabetic(a.getKeyChar())){
           a.consume();
           JOptionPane.showMessageDialog(null, "Masukan Angka Saja!", "Peringatan", JOptionPane.WARNING_MESSAGE);
       }
   }
    
    public final void loadData() {
    btSimpan.setEnabled(true);
    btHapus.setEnabled(false);
    btEdit.setEnabled(false);
    model.getDataVector().removeAllElements();
    model.fireTableDataChanged();
        try {
        try (Statement s = conn.createStatement()) {
            String sql = "SELECT * FROM jenispembayaran";
            try (ResultSet r = s.executeQuery(sql)) {
                while (r.next()) {
                    Object[] o = new Object[4];
                    o[0] = r.getString("kodepembayaran");
                    o[1] = r.getString("namapembayaran");
                    o[2] = r.getString("jumlahbayar");
                    o[3] = r.getString("perbulan");
                    
                    model.addRow(o);
                }
            }
        }
        } catch (SQLException e) {
            JOptionPane.showMessageDialog(this, "ERROR : \n" + e.toString(), "Kesalahan", JOptionPane.ERROR_MESSAGE);
        }
    }
    
    protected void kosong() {
        tkode.setText("");
        tnamabayar.setText("");
        tperbulan.setText("");
        tbayar.setText("");
    }
    
    protected void aktif() {
        tkode.requestFocus();       // Pengecekan apakah textfield aktif atau tidak
        
        btSimpan.setEnabled(true);
        btEdit.setEnabled(false);
        btHapus.setEnabled(false);
        btBatal.setEnabled(true);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        jPanel2 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        tkode = new javax.swing.JTextField();
        tnamabayar = new javax.swing.JTextField();
        jLabel5 = new javax.swing.JLabel();
        jLabel6 = new javax.swing.JLabel();
        tperbulan = new javax.swing.JTextField();
        btSimpan = new javax.swing.JButton();
        btEdit = new javax.swing.JButton();
        btHapus = new javax.swing.JButton();
        btBatal = new javax.swing.JButton();
        jLabel3 = new javax.swing.JLabel();
        tbayar = new javax.swing.JTextField();
        jLabel7 = new javax.swing.JLabel();
        jScrollPane1 = new javax.swing.JScrollPane();
        tabelpendapatan = new javax.swing.JTable();
        btKembali = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("Data Jenis Pembayaran");
        setResizable(false);

        jPanel1.setBackground(new java.awt.Color(255, 255, 255));
        jPanel1.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        jPanel2.setBackground(new java.awt.Color(255, 255, 255));
        jPanel2.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)), "Input Jenis Pembayaran"));
        jPanel2.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        jLabel1.setText("Kode Pembayaran");
        jPanel2.add(jLabel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 40, -1, 20));

        jLabel2.setText("Nama Pembayaran");
        jPanel2.add(jLabel2, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 80, -1, 20));
        jPanel2.add(tkode, new org.netbeans.lib.awtextra.AbsoluteConstraints(160, 40, 157, -1));
        jPanel2.add(tnamabayar, new org.netbeans.lib.awtextra.AbsoluteConstraints(160, 80, 157, -1));

        jLabel5.setText("Nilai Biaya");
        jPanel2.add(jLabel5, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 120, 60, 20));

        jLabel6.setText("Rp");
        jPanel2.add(jLabel6, new org.netbeans.lib.awtextra.AbsoluteConstraints(140, 160, -1, 20));

        tperbulan.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                tperbulanKeyTyped(evt);
            }
        });
        jPanel2.add(tperbulan, new org.netbeans.lib.awtextra.AbsoluteConstraints(160, 160, 160, -1));

        btSimpan.setBackground(new java.awt.Color(28, 31, 44));
        btSimpan.setForeground(new java.awt.Color(255, 255, 255));
        btSimpan.setText("Simpan");
        btSimpan.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btSimpanActionPerformed(evt);
            }
        });
        jPanel2.add(btSimpan, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 240, 80, -1));

        btEdit.setBackground(new java.awt.Color(28, 31, 44));
        btEdit.setForeground(new java.awt.Color(255, 255, 255));
        btEdit.setText("Edit");
        btEdit.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btEditActionPerformed(evt);
            }
        });
        jPanel2.add(btEdit, new org.netbeans.lib.awtextra.AbsoluteConstraints(110, 240, 60, -1));

        btHapus.setBackground(new java.awt.Color(28, 31, 44));
        btHapus.setForeground(new java.awt.Color(255, 255, 255));
        btHapus.setText("Hapus");
        btHapus.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btHapusActionPerformed(evt);
            }
        });
        jPanel2.add(btHapus, new org.netbeans.lib.awtextra.AbsoluteConstraints(180, 240, 70, -1));

        btBatal.setBackground(new java.awt.Color(28, 31, 44));
        btBatal.setForeground(new java.awt.Color(255, 255, 255));
        btBatal.setText("Batal");
        btBatal.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btBatalActionPerformed(evt);
            }
        });
        jPanel2.add(btBatal, new org.netbeans.lib.awtextra.AbsoluteConstraints(260, 240, 64, -1));

        jLabel3.setText("Biaya Per Bulan");
        jPanel2.add(jLabel3, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 160, 90, 20));

        tbayar.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                tbayarKeyTyped(evt);
            }
        });
        jPanel2.add(tbayar, new org.netbeans.lib.awtextra.AbsoluteConstraints(160, 120, 157, -1));

        jLabel7.setText("Rp");
        jPanel2.add(jLabel7, new org.netbeans.lib.awtextra.AbsoluteConstraints(140, 120, -1, 20));

        jPanel1.add(jPanel2, new org.netbeans.lib.awtextra.AbsoluteConstraints(22, 35, 352, 330));

        tabelpendapatan.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {},
                {},
                {},
                {}
            },
            new String [] {

            }
        ));
        tabelpendapatan.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                tabelpendapatanMouseClicked(evt);
            }
        });
        jScrollPane1.setViewportView(tabelpendapatan);

        jPanel1.add(jScrollPane1, new org.netbeans.lib.awtextra.AbsoluteConstraints(392, 49, 595, 264));

        btKembali.setBackground(new java.awt.Color(28, 31, 44));
        btKembali.setForeground(new java.awt.Color(255, 255, 255));
        btKembali.setIcon(new javax.swing.ImageIcon(getClass().getResource("/icon/icons8-back-25.png"))); // NOI18N
        btKembali.setText("Kembali");
        btKembali.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btKembaliActionPerformed(evt);
            }
        });
        jPanel1.add(btKembali, new org.netbeans.lib.awtextra.AbsoluteConstraints(869, 326, 120, 30));

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, 1039, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, 412, Short.MAX_VALUE)
        );

        pack();
        setLocationRelativeTo(null);
    }// </editor-fold>//GEN-END:initComponents

    private void tabelpendapatanMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tabelpendapatanMouseClicked
        // TODO add your handling code here:
        btSimpan.setEnabled(false);
        btEdit.setEnabled(true);
        btHapus.setEnabled(true);
        try{
            int bar = tabelpendapatan.getSelectedRow();
            String a = model.getValueAt(bar, 0).toString();
            String b = model.getValueAt(bar, 1).toString();
            String c = model.getValueAt(bar, 2).toString();
            String d = model.getValueAt(bar, 3).toString();
         
            tkode.setText(a);
            tkode.setEnabled(false);
            tnamabayar.setText(b);
            tbayar.setText(c);
            tperbulan.setText(d);
     
        } catch (Exception e){
            JOptionPane.showMessageDialog(this, "ERROR : \n" + e.toString(), "Kesalahan", JOptionPane.ERROR_MESSAGE);
        }
    }//GEN-LAST:event_tabelpendapatanMouseClicked

    private void btSimpanActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btSimpanActionPerformed
        // TODO add your handling code here:
         if(tkode.getText().equals("") || tnamabayar.getText().equals("")|| tbayar.getText().equals("")) {
            JOptionPane.showMessageDialog(null, "Lengkapi Data!", "SDIT Bahrul Fikri", JOptionPane.INFORMATION_MESSAGE);
         } else {            
            String kode = tkode.getText();
            String nama = tnamabayar.getText();
            String jumlah = tbayar.getText();
            String nilai = tperbulan.getText();
            try {
                String sql = "INSERT INTO jenispembayaran VALUES (?, ?, ?, ?)";

                try (PreparedStatement p = conn.prepareStatement(sql)) {
                    p.setString(1, kode);
                    p.setString(2, nama);
                    p.setString(3, nilai);
                    p.setString(4, jumlah);
                    
                    p.executeUpdate();
                }
            } catch (SQLException e) {
                JOptionPane.showMessageDialog(this, "ERROR : \n" + e.toString(), "Kesalahan", JOptionPane.ERROR_MESSAGE);
            } finally {
                loadData();
                kosong();
                aktif();
                JOptionPane.showMessageDialog(null, "Data Berhasil Tersimpan", "SDIT Bahrul Fikri", JOptionPane.INFORMATION_MESSAGE);
            }
        }
    }//GEN-LAST:event_btSimpanActionPerformed

    private void btEditActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btEditActionPerformed
        // TODO add your handling code here:
        try{
            String sql="UPDATE jenispembayaran SET namapembayaran=?, perbulan=?, jumlahbayar=? where kodepembayaran='"+tkode.getText()+"'";
            PreparedStatement stat=conn.prepareStatement(sql);
            
        stat.setString(1, tnamabayar.getText());
        stat.setString(2, tperbulan.getText());
        stat.setString(3, tbayar.getText());

        stat.executeUpdate();
        
            JOptionPane.showMessageDialog(null, "Data Berhasil Diubah");
            kosong();
            aktif();
            loadData();
            btSimpan.setEnabled(true);
            
        } catch (SQLException e) {
            JOptionPane.showMessageDialog(null, "Data Gagal Diubah"+e);
        }        
    }//GEN-LAST:event_btEditActionPerformed

    private void btHapusActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btHapusActionPerformed
        // TODO add your handling code here:
        int confirm = JOptionPane.showConfirmDialog(null, "Ingin Menghapus Data?", "Konfirmasi", JOptionPane.YES_NO_OPTION);
        if(confirm==JOptionPane.YES_OPTION) {

            try {
                String sql ="DELETE FROM jenispembayaran WHERE kodepembayaran='"+tkode.getText()+"'";

                java.sql.PreparedStatement ps=conn.prepareStatement(sql);
                ps.execute();
                JOptionPane.showMessageDialog(this, "Data Berhasil Dihapus");
            } catch (HeadlessException | SQLException e) {
                JOptionPane.showMessageDialog(this, "ERROR : \n" + e.toString(), "Kesalahan", JOptionPane.ERROR_MESSAGE);
            }
            loadData();
            kosong();
            aktif();
        }
    }//GEN-LAST:event_btHapusActionPerformed

    private void btBatalActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btBatalActionPerformed
        // TODO add your handling code here:
        kosong();
        btSimpan.setEnabled(true);
        btEdit.setEnabled(false);
    }//GEN-LAST:event_btBatalActionPerformed

    private void tbayarKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_tbayarKeyTyped
        // TODO add your handling code here:
        FilterAngka(evt);
    }//GEN-LAST:event_tbayarKeyTyped

    private void tperbulanKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_tperbulanKeyTyped
        // TODO add your handling code here:
        FilterAngka(evt);
    }//GEN-LAST:event_tperbulanKeyTyped

    private void btKembaliActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btKembaliActionPerformed
        new Utama().setVisible(true);
        this.setVisible(false);
    }//GEN-LAST:event_btKembaliActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException | InstantiationException | IllegalAccessException | javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(DataJenisPembayaran.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>
        

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(() -> {
            new DataJenisPembayaran().setVisible(true);
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btBatal;
    private javax.swing.JButton btEdit;
    private javax.swing.JButton btHapus;
    private javax.swing.JButton btKembali;
    private javax.swing.JButton btSimpan;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTable tabelpendapatan;
    private javax.swing.JTextField tbayar;
    private javax.swing.JTextField tkode;
    private javax.swing.JTextField tnamabayar;
    private javax.swing.JTextField tperbulan;
    // End of variables declaration//GEN-END:variables
}
